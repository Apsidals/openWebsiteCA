# .github/workflows/open-website.yml

name: Open Website with Browser

on:
  schedule:
    # Runs every 10 minutes.
    - cron: '*/10 * * * *'
  workflow_dispatch: # Allows manual runs

jobs:
  visit-site:
    runs-on: ubuntu-latest

    env:
      # IMPORTANT: Change this URL to the website you want to open.
      TARGET_URL: "https://atpmatchpredictions.vercel.app/"
      # The maximum random delay in seconds (8 minutes = 480 seconds ).
      MAX_DELAY_SECONDS: 10

    steps:
      # Step 1: Wait for a random amount of time.
      - name: Wait for a random delay (0-8 minutes)
        run: |
          DELAY=$(( RANDOM % (MAX_DELAY_SECONDS + 1) ))
          MINUTES=$(( DELAY / 60 ))
          SECONDS=$(( DELAY % 60 ))
          echo "Action scheduled. Waiting for ${MINUTES}m ${SECONDS}s..."
          sleep $DELAY

      # Step 2: Check out the repository code.
      # This makes our local files (like open-site.js) available to the workflow.
      - name: Check out repository code
        uses: actions/checkout@v4

      # Step 3: Set up Node.js environment.
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a stable LTS version of Node.js
          cache: 'npm' # Cache npm dependencies for faster installs

      # Step 4: Install project dependencies (Playwright).
      # This command reads package.json and installs what's needed.
      - name: Install dependencies
        run: npm install

      # Step 5: Install Playwright browsers.
      # This is a required step to download the browser binaries (Chromium).
      - name: Install Playwright Browsers
        run: npx playwright install --with-deps chromium

      # Step 6: Run the Playwright script.
      # The TARGET_URL env var is automatically passed to the script.
      - name: Run Playwright script to visit site
        run: node open-site.js

      # Step 7 (Optional): Upload the screenshot as an artifact.
      # This lets you download and view the screenshot from the workflow run summary page.
      - name: Upload screenshot artifact
        if: always() # Run this step even if the script fails
        uses: actions/upload-artifact@v4
        with:
          name: website-screenshot
          path: visit-screenshot.png
          retention-days: 5 # Keep artifacts for 5 days
